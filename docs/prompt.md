1. 주문, 결제 프로세스
   1. 주문 번호 채번 FO -> API orderService 의 generateOrderNumber 사용.
   2. /api/payments/initiate 호출 해 결제 요청 파라미터 생성 (FO -> API)
   3. 생성된 파라미터로 결제 요청 window.INIStdPay.pay('inicisForm') (FO)
   4. 결제 요청 응답을 returnUrl(FO 의 /order/progress) 받아 성공 했을 경우 이후 프로세스 진행
   5. 현재 주문에 관련된 정보들을 세션에 저장.
   6. progress.vue 에서 processPaymentReturn 에서
      현재는 /payments/confirm 를 호출 하지만,
      5번에 저장된 주문의 정보들을 기반으로 주문을 진행하는 /api/orders/order 를 호출하고,
      이 API 내에서 주문 정보를 insert 하고 paymentService.confirmPayment 를 호출 하도록 바꿀거야.
   7. 주문이 완료 되면 주문 완료 페이지로, 실패 했을 경우 실패 페이지로 이동.

2. 브라우저, 서버 간 데이터 공유 제한으로 인한 팝업 창으로 변경
현재 응답 결과를 이니시스 측에서 post 로 리다이렉트 해주고, 그 값을 이용해서 주문을 진행해야하는데,
vue 에서 받을 경우 Post 는 SSR 일때만 받을 수 있어 브라우저와 서버의 쿠키가 공유가 안되고 있어.
이를 해결하기 위해서 페이지 이동이 아닌 팝업을 새로 띄우려고 해.
주문서에서 결제하기 버튼을 누르면 페이지 이동하는게 아닌 새로운 팝업을 띄우고,
팝업에서 progress 로 이동한 다음에,
리다이렉트 된 정보를 부모 페이지에 넘겨 주면서 팝업을 닫는거야.
부모 페이지에서는 받은 값을 기반으로 주문을 호출하도록 수정 개발 진행해줘.

2에 대한 답변
    1. 팝업 창 플로우 확인
        주문서 → 결제하기 클릭 → 팝업 열기 →
        팝업에서 이니시스 결제 → 팝업에서 progress 처리 →
        부모창에 결과 전달 → 팝업 닫기 → 부모창에서 주문 처리
        이 플로우가 맞나요?
        => 맞아.
    
    2. 팝업에서 부모창으로 데이터 전달 방식
     - window.postMessage() 사용하는 건가요? => 맞아
     - 어떤 데이터를 전달해야 하나요? (이니시스 응답 + 주문 정보?) => 맞아

   3. 주문 정보 저장 위치 변경
   - 현재: 쿠키/로컬스토리지
   - 변경 후: 부모창의 JavaScript 변수에 보관?
    음. 부모창에 저장 해도 구현 가능하면 그렇게 해줘. 안된다면 쿠키에 저장해주고.

   4. 팝업 URL 경로

   - 팝업창 URL은 어떻게 할까요? /order/popup 같은 새로운 페이지?
   - 아니면 기존 주문서 페이지를 팝업으로?
        => 새로운 페이지를 만들어줘 /order/progress-popup 이런식으로 하면 될 것 같아

   5. 이니시스 설정 변경

   - returnUrl, closeUrl을 팝업 경로로 변경해야 하나요?
        => 응 returnUrl 을 위에서 만든 팝업 경로로 변경해줘.


3. 현재 주문 생성의 request 가 이렇게 되어 있는데 좀 구조화 되었으면 좋겠어
```
    주문정보
        주문자명
        이름
        전화번호
        이메일
        ...
    List<결제정보>
        결제수단
        결제금액
        결제승인요청정보
            ...
    List<배송그룹>
        배송지정보
            배송지
            전화번호
            수취인
        List<상품정보>
            상품번호
            가격
            상품명
```

```
현재 FO, API 를 여러 AI 툴을 이용해서 개발을 진행해 소스에 일관성이 없어.
소스를 전반적으로 분석한 후,
1. 미사용 소스 제거
2. 소스를 일관된 스타일로 리팩토링
3. 리팩토링 된 소스 기반으로 docs 에 문서 작성.
   이 요구사항을 충족할 떄까지 나한테 더 물어보지 말고, 빌드 성공까지 가능하도록 개발 진행해줘
```


20250919 10:29
```
point 에 대한 부분을 수정할거야.

1. 
현재 포인트에 대한 내용은 reward_points 에 서만 관리되고 있는데.
결제/취소에 따른 내용도 payment 테이블에도 쌓이도록 개발해.

2. 
point_history 테이블을 하나 생성해서 적립 사용에 대한 내역을 볼 수 있도록 개발해.
```

20250921 14:23
포인트 사용시 payment 테이블에도 쌓이게 하고 싶어.
1. pay_type 을 추가해서 결제인지 환불인지 관리 해줘.
2. payment 테이블의 pk 를 payment_id, payment_method, order_id, pay_type 이렇게 수정해.
3. 포인트 결제건의 경우 payment_method 에 POINT, pg_company 에 null을 넣어줘.

20250922 09:53
1. 회원 상세에서 포인트 사용기록은 잘 보이는데, 주문 내역은 보이지 않고 있어.
    mapper 에 findByOrderIdAndOrdSeqAndOrdProcSeq 가 없어서 그런 것으로 보여.
2. 현재 주문이 완료 됐다는 API 응답이 오지 않아도 주문 완료 페이지로 이동하고 있어. 주문 완료 응답이 오고(createOrder), 이 응답이 정상 응답일 경우 주문 완료 페이지로 이동하고, 실패 했을 경우 주문 실패 페이지로 이동하게 개발해줘.
