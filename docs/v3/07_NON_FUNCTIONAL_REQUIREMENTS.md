# 7. 비기능 요구사항

## 7.1. 성능 목표
- **응답 시간**: 모든 API 호출은 평균 200ms 이내, 최대 500ms 이내로 응답해야 합니다. (PG사 연동 등 외부 의존성으로 인한 지연은 예외로 간주될 수 있으나, 내부 처리 시간은 이 기준을 준수해야 합니다.)
- **처리량 (TPS)**: 핵심 결제 및 주문 API는 초당 최소 100 트랜잭션(TPS)을 처리할 수 있어야 합니다.
- **동시 사용자 수**: 최소 1,000명의 동시 사용자를 안정적으로 지원해야 합니다.
- **데이터베이스 쿼리**: 대부분의 데이터베이스 쿼리는 50ms 이내에 완료되어야 합니다.

## 7.2. 보안 요구사항
- **데이터 암호화**: 민감한 사용자 정보(예: 이메일, 전화번호) 및 결제 정보는 데이터베이스 저장 시 암호화되어야 합니다. (현재는 평문 저장)
- **통신 보안**: 모든 클라이언트-서버 통신은 HTTPS를 통해 암호화되어야 합니다.
- **접근 제어**: API 접근에 대한 인증 및 인가 메커니즘을 구현하여 비인가된 접근을 차단해야 합니다. (현재는 미구현)
- **SQL Injection 방지**: MyBatis를 사용하여 PreparedStatement 기반의 쿼리를 사용함으로써 SQL Injection 공격을 방지합니다.
- **XSS/CSRF 방지**: 프론트엔드 단에서 XSS(Cross-Site Scripting) 및 CSRF(Cross-Site Request Forgery) 공격 방지를 위한 보안 조치를 적용해야 합니다.
- **PG사 연동 보안**: PG사와의 통신은 각 PG사가 제공하는 보안 프로토콜(예: 암호화된 데이터 전송, 해시 검증)을 준수해야 합니다.

## 7.3. 로깅 및 모니터링 전략
- **로깅 프레임워크**: 백엔드는 SLF4J와 Logback을 사용하여 애플리케이션 로그를 기록합니다.
- **로그 레벨**: `INFO`, `WARN`, `ERROR` 레벨의 로그를 적절히 사용하여 시스템의 상태 변화, 경고, 오류 상황을 기록합니다.
- **결제 인터페이스 로그**: `PAYMENT_INTERFACE_REQUEST_LOG` 테이블에 PG사와의 모든 요청 및 응답 페이로드를 기록하여 결제 관련 문제 발생 시 상세 분석 자료로 활용합니다.
- **모니터링**: Prometheus, Grafana와 같은 도구를 활용하여 시스템 리소스(CPU, Memory, Disk, Network), 애플리케이션 성능 지표(API 응답 시간, TPS, 에러율), 데이터베이스 성능 등을 실시간으로 모니터링합니다.
- **알림**: 특정 임계값 초과 또는 심각한 오류 발생 시 Slack, 이메일 등으로 관리자에게 자동 알림을 전송하는 시스템을 구축합니다.

## 7.4. 에러 처리 및 복구 방식
- **예외 처리**: Spring의 `@ControllerAdvice`와 `@ExceptionHandler`를 활용하여 전역적인 예외 처리를 구현합니다. 비즈니스 로직에서 발생하는 예외는 `BusinessException`, `OrderException`, `PaymentException` 등 커스텀 예외를 정의하여 사용합니다.
- **오류 응답**: 클라이언트에게는 `ErrorResponse` 객체를 통해 일관된 형식의 오류 메시지와 HTTP 상태 코드를 반환합니다.
- **트랜잭션 롤백**: `@Transactional` 어노테이션을 통해 트랜잭션 내에서 예외 발생 시 자동으로 데이터베이스 변경 사항을 롤백하여 데이터 일관성을 유지합니다.
- **망취소 로직**: 결제 승인 후 주문 생성 과정에서 오류 발생 시, 이미 승인된 결제에 대해 PG사 망취소 API를 호출하여 결제만 취소하고 사용자에게 환불하는 복구 로직을 구현합니다.
- **재시도 메커니즘**: 외부 API 호출(특히 PG사 연동) 시 일시적인 네트워크 오류 등에 대비하여 적절한 재시도(Retry) 메커니즘을 적용할 수 있습니다. (현재는 명시적인 재시도 로직 없음)
- **장애 복구**: 데이터베이스 백업 및 복구 전략을 수립하고, 다중화된 서버 구성을 통해 단일 장애 지점(SPOF)을 제거하여 시스템 가용성을 확보합니다.
