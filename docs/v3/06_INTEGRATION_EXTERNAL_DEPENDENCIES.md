# 6. 통합 및 외부 의존성

## 6.1. 외부 API 연동 스펙

### 6.1.1. PG사 (Payment Gateway) 연동
- **목적**: 실제 결제 승인, 취소, 환불 등의 금융 거래를 처리합니다.
- **연동 방식**: 각 PG사(이니시스, 나이스페이, 토스페이먼츠)의 RESTful API 또는 SDK를 통해 연동합니다. `PaymentGatewayAdapter` 인터페이스를 구현하여 각 PG사의 특성을 추상화하고 통일된 방식으로 처리합니다.
- **주요 연동 기능**:
    - **결제 초기화 (Initiate Payment)**: 결제창 호출에 필요한 파라미터 생성 및 PG사 시스템에 결제 정보 등록.
    - **결제 승인 (Confirm Payment)**: PG사로부터 전달받은 결제 결과(인증 토큰 등)를 기반으로 최종 결제 승인 요청.
    - **결제 취소/환불 (Cancel/Refund Payment)**: 승인된 결제에 대한 취소 또는 부분 환불 요청.
    - **망취소 (Net Cancel)**: 결제 승인 후 시스템 내부 오류로 주문 처리가 실패했을 경우, PG사에 결제 취소를 요청하여 결제만 취소하는 기능.
- **데이터 흐름**: 
    1. 클라이언트 -> Vibe Pay 백엔드: 결제 시작 요청 (`/api/payments/initiate`)
    2. Vibe Pay 백엔드 -> PG사 API: 결제 초기화 요청
    3. PG사 API -> Vibe Pay 백엔드: 결제 초기화 응답
    4. Vibe Pay 백엔드 -> 클라이언트: 결제창 띄우기 위한 정보 반환
    5. 클라이언트 -> PG사 결제창: 사용자 결제 진행
    6. PG사 -> Vibe Pay 백엔드: 결제 결과 리턴 (`/api/payments/return`)
    7. Vibe Pay 백엔드 -> PG사 API: 결제 승인 요청
    8. PG사 API -> Vibe Pay 백엔드: 결제 승인 응답
    9. Vibe Pay 백엔드 -> 클라이언트: 최종 결제 결과 반환

## 6.2. 인증/인가 메커니즘
- **현재 상태**: 현재 구현된 백엔드 시스템에는 사용자 인증(로그인) 및 인가(권한 확인) 메커니즘이 명시적으로 구현되어 있지 않습니다. `memberId`와 같은 식별자를 API 요청 시 직접 전달받아 사용합니다.
- **향후 계획**: 실제 서비스 환경에서는 JWT(JSON Web Token) 또는 OAuth2와 같은 표준 기반의 인증/인가 시스템을 도입하여 API 접근을 제어하고 사용자 세션을 관리해야 합니다.

## 6.3. 서드파티 라이브러리 사용 목적

### 6.3.1. 백엔드 (Java)
- **Spring Boot**: 웹 애플리케이션 개발 프레임워크. 빠른 개발, 의존성 주입, 자동 설정 등을 통해 개발 생산성 향상.
- **MyBatis**: SQL Mapper 프레임워크. SQL을 직접 작성하여 데이터베이스 접근을 세밀하게 제어하고 성능 최적화에 활용.
- **PostgreSQL JDBC Driver**: PostgreSQL 데이터베이스와의 연결 및 통신을 위한 드라이버.
- **Spring WebFlux**: 비동기, 논블로킹 웹 애플리케이션 개발 프레임워크. PG사 연동 등 외부 서비스와의 고성능 비동기 통신에 사용.
- **Lombok**: 코드 자동 생성 라이브러리. Getter, Setter, 생성자 등 반복적인 코드 작성을 줄여 코드 가독성 및 생산성 향상.
- **SLF4J & Logback**: 로깅 프레임워크. 애플리케이션 로그를 체계적으로 관리하고 디버깅 및 모니터링에 활용.

### 6.3.2. 프론트엔드 (Nuxt.js)
- **Nuxt.js**: Vue.js 기반의 프레임워크. SSR, SSG 지원으로 SEO 및 초기 로딩 성능 최적화, 개발 편의성 제공.
- **Vue.js**: UI 컴포넌트 기반 프레임워크. 반응형 UI 개발 및 컴포넌트 재사용성 증대.
- **Vuetify**: Material Design 기반 UI 프레임워크. 일관되고 미려한 UI를 빠르게 구축하고 개발 시간 단축.
- **TypeScript**: JavaScript의 상위 집합. 타입 안정성을 제공하여 코드의 유지보수성 및 안정성 향상.

## 6.4. 환경변수 및 설정 관리
- **백엔드**: `application.yml` 파일을 통해 데이터베이스 연결 정보, PG사 연동 키, API 엔드포인트 등 환경별 설정을 관리합니다. 민감 정보(예: PG사 Secret Key)는 환경 변수 또는 외부 설정 관리 시스템(예: Spring Cloud Config, HashiCorp Vault)을 통해 관리하는 것을 권장합니다.
- **프론트엔드**: Nuxt.js의 런타임 환경 변수 기능을 활용하여 API 엔드포인트 등 환경별 설정을 관리합니다.
