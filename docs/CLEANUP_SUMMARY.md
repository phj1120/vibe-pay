# ν”„λ΅μ νΈ μ •λ¦¬ μ”μ•½

## π§Ή μ •λ¦¬ μ™„λ£ ν•­λ©

### 1. ν”„λ΅ νΈμ—”λ“ μ •λ¦¬
- β… **λ¶ν•„μ”ν• λ””λ ‰ν† λ¦¬ μ κ±°**
  - `pages/api/` - μ‚¬μ©ν•μ§€ μ•λ” API λΌμ°νΈ
  - `pages/webhook/` - μ‚¬μ©ν•μ§€ μ•λ” μ›Ήν›… νμ΄μ§€
  - `server/api/` - μ‚¬μ©ν•μ§€ μ•λ” μ„λ²„ API
  - `server/middleware/` - μ‚¬μ©ν•μ§€ μ•λ” λ―Έλ“¤μ›¨μ–΄
  - `server/` - λΉ λ””λ ‰ν† λ¦¬ μ κ±°

- β… **Nuxt μ„¤μ • μ •λ¦¬**
  - `nuxt.config.ts`μ— μ£Όμ„ μ¶”κ°€λ΅ κ°€λ…μ„± ν–¥μƒ
  - λ¶ν•„μ”ν• μ‹¤ν—μ  μ„¤μ • μ κ±°

### 2. λ°±μ—”λ“ μ •λ¦¬
- β… **PaymentService μ •λ¦¬**
  - `generateOrdNo()` - μ‚¬μ©ν•μ§€ μ•λ” λ©”μ„λ“ μ κ±°
  - `handleReturn()` - μ¤‘λ³µ κΈ°λ¥ λ©”μ„λ“ μ κ±°
  - `approveWithAuth()` - μ¤‘λ³µ κΈ°λ¥ λ©”μ„λ“ μ κ±°
  - `bytesToHex()` - μ‚¬μ©ν•μ§€ μ•λ” ν—¬νΌ λ©”μ„λ“ μ κ±°

- β… **Import μ •λ¦¬**
  - `java.time.LocalDateTime` - μ‚¬μ©ν•μ§€ μ•λ” import μ κ±°
  - `java.time.format.DateTimeFormatter` - μ‚¬μ©ν•μ§€ μ•λ” import μ κ±°
  - `javax.crypto.*` - μ‚¬μ©ν•μ§€ μ•λ” μ•”νΈν™” import μ κ±°

### 3. μ•”νΈν™” λ°©μ‹ ν†µμΌ
- β… **SHA-256 λ°©μ‹μΌλ΅ ν†µμΌ**
  - κ²°μ  μ”μ²­: `sha256Hex()` λ©”μ„λ“ μ‚¬μ©
  - μΉμΈ μ”μ²­: `sha256Hex()` λ©”μ„λ“ μ‚¬μ©
  - λ§μ·¨μ†: `sha256Hex()` λ©”μ„λ“ μ‚¬μ©

## π“ μµμΆ… ν”„λ΅μ νΈ κµ¬μ΅°

### ν”„λ΅ νΈμ—”λ“
```
vibe-pay-frontend/
β”β”€β”€ app.vue
β”β”€β”€ layouts/
β”‚   β””β”€β”€ default.vue
β”β”€β”€ pages/
β”‚   β”β”€β”€ index.vue
β”‚   β”β”€β”€ members/
β”‚   β”β”€β”€ order/
β”‚   β”‚   β”β”€β”€ close.vue
β”‚   β”‚   β”β”€β”€ index.vue
β”‚   β”‚   β”β”€β”€ popup.vue
β”‚   β”‚   β”β”€β”€ progress.vue    # μ΄λ‹μ‹μ¤ POST μ²λ¦¬
β”‚   β”‚   β””β”€β”€ return.vue      # κ²°μ  κ²°κ³Ό νμ΄μ§€
β”‚   β””β”€β”€ products/
β”β”€β”€ plugins/
β”‚   β””β”€β”€ inicis.client.ts
β”β”€β”€ nuxt.config.ts
β””β”€β”€ package.json
```

### λ°±μ—”λ“
```
vibe-pay-backend/
β”β”€β”€ src/main/java/com/vibe/pay/backend/
β”‚   β”β”€β”€ payment/
β”‚   β”‚   β”β”€β”€ PaymentService.java    # μ •λ¦¬ μ™„λ£
β”‚   β”‚   β”β”€β”€ PaymentController.java
β”‚   β”‚   β””β”€β”€ ...
β”‚   β””β”€β”€ ...
β””β”€β”€ src/main/resources/
    β”β”€β”€ application.yml            # μ„¤μ • μ •λ¦¬ μ™„λ£
    β””β”€β”€ ...
```

## π― ν•µμ‹¬ κΈ°λ¥ ν”λ΅μ°

### κ²°μ  μ²λ¦¬ ν”λ΅μ°
1. **μ£Όλ¬Έ μƒμ„±** β†’ `OrderService.createOrder()`
2. **κ²°μ  μ”μ²­** β†’ `PaymentService.initiatePayment()`
3. **μ΄λ‹μ‹μ¤ κ²°μ ** β†’ μ™Έλ¶€ κ²°μ μ°½
4. **κ²°κ³Ό μμ‹ ** β†’ `progress.vue` (SSR)
5. **μΉμΈ μ²λ¦¬** β†’ `PaymentService.processInicisApproval()`
6. **κ²°κ³Ό ν‘μ‹** β†’ `return.vue`

### μ£Όμ” κ°μ„ μ‚¬ν•­
- β… CORS λ¬Έμ  ν•΄κ²° (SSR λ°©μ‹ μ‚¬μ©)
- β… μ•”νΈν™” λ°©μ‹ ν†µμΌ (SHA-256)
- β… μ½”λ“ μ¤‘λ³µ μ κ±°
- β… λ¶ν•„μ”ν• νμΌ/λ©”μ„λ“ μ •λ¦¬
- β… μ—λ¬ μ²λ¦¬ κ°μ„ 

## π€ μ„±λ¥ λ° μ μ§€λ³΄μμ„± ν–¥μƒ

### Before vs After
| ν•­λ© | Before | After |
|------|---------|--------|
| ν”„λ΅ νΈμ—”λ“ νμΌ μ | λ§μ (μ¤‘λ³µ/λ―Έμ‚¬μ©) | μµμ†ν™” |
| λ°±μ—”λ“ λ©”μ„λ“ μ | μ¤‘λ³µ μ΅΄μ¬ | μ •λ¦¬ μ™„λ£ |
| μ•”νΈν™” λ°©μ‹ | νΌμ¬ (HMAC/SHA-256) | ν†µμΌ (SHA-256) |
| CORS μ²λ¦¬ | λ¬Έμ  μμ | ν•΄κ²° μ™„λ£ |
| μ½”λ“ κ°€λ…μ„± | λ³΄ν†µ | ν–¥μƒ |

## π“‹ λ‚¨μ€ μ‘μ—… (μ„ νƒμ‚¬ν•­)

1. **ν…μ¤νΈ μ½”λ“ μ‘μ„±**
   - PaymentService λ‹¨μ„ ν…μ¤νΈ
   - ν†µν•© ν…μ¤νΈ μ‹λ‚λ¦¬μ¤

2. **λ΅κΉ… κ°μ„ **
   - κµ¬μ΅°ν™”λ λ΅κ·Έ ν¬λ§·
   - λ―Όκ°μ •λ³΄ λ§μ¤ν‚Ή

3. **λ¬Έμ„ν™”**
   - API λ¬Έμ„ (Swagger)
   - λ°°ν¬ κ°€μ΄λ“

4. **λ³΄μ• κ°•ν™”**
   - ν™κ²½λ³€μ κ΄€λ¦¬
   - μ…λ ¥κ°’ κ²€μ¦ κ°•ν™”
