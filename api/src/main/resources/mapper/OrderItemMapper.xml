<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.vibe.pay.domain.order.repository.OrderItemMapper">

    <!-- Result Map -->
    <resultMap id="OrderItemResultMap" type="OrderItem">
        <id property="orderItemId" column="order_item_id"/>
        <result property="orderId" column="order_id"/>
        <result property="ordSeq" column="ord_seq"/>
        <result property="ordProcSeq" column="ord_proc_seq"/>
        <result property="productId" column="product_id"/>
        <result property="quantity" column="quantity"/>
        <result property="priceAtOrder" column="price_at_order"/>
    </resultMap>

    <!-- Insert -->
    <insert id="insert" parameterType="OrderItem" useGeneratedKeys="true" keyProperty="orderItemId" keyColumn="order_item_id">
        INSERT INTO order_item (
            order_id,
            ord_seq,
            ord_proc_seq,
            product_id,
            quantity,
            price_at_order,
            created_at
        ) VALUES (
            #{orderId},
            #{ordSeq},
            #{ordProcSeq},
            #{productId},
            #{quantity},
            #{priceAtOrder},
            NOW()
        )
    </insert>

    <!-- Find by Order ID -->
    <select id="findByOrderId" resultMap="OrderItemResultMap">
        SELECT
            order_item_id,
            order_id,
            ord_seq,
            ord_proc_seq,
            product_id,
            quantity,
            price_at_order
        FROM order_item
        WHERE order_id = #{orderId}
        ORDER BY order_item_id ASC
    </select>

    <!-- Find by Order ID and Order Process Sequence -->
    <select id="findByOrderIdAndOrdProcSeq" resultMap="OrderItemResultMap">
        SELECT
            order_item_id,
            order_id,
            ord_seq,
            ord_proc_seq,
            product_id,
            quantity,
            price_at_order
        FROM order_item
        WHERE order_id = #{orderId}
          AND ord_proc_seq = #{ordProcSeq}
        ORDER BY order_item_id ASC
    </select>

    <!-- Find All -->
    <select id="findAll" resultMap="OrderItemResultMap">
        SELECT
            order_item_id,
            order_id,
            ord_seq,
            ord_proc_seq,
            product_id,
            quantity,
            price_at_order
        FROM order_item
        ORDER BY order_item_id ASC
    </select>

    <!-- Update -->
    <update id="update" parameterType="OrderItem">
        UPDATE order_item
        SET
            product_id = #{productId},
            quantity = #{quantity},
            price_at_order = #{priceAtOrder}
        WHERE order_item_id = #{orderItemId}
    </update>

    <!-- Delete -->
    <delete id="delete">
        DELETE FROM order_item
        WHERE order_item_id = #{orderItemId}
    </delete>

</mapper>
