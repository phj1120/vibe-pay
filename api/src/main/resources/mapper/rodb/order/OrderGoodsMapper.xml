<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.api.app.repository.order.OrderGoodsMapper">

    <!-- 주문상품 전체 조회 -->
    <select id="selectAllOrderGoods" resultType="OrderGoods">
        SELECT /* OrderGoodsMapper.selectAllOrderGoods */
               ORDER_NO
             , GOODS_NO
             , ITEM_NO
             , SALE_PRICE
             , SUPPLY_PRICE
             , GOODS_NAME
             , ITEM_NAME
          FROM ORDER_GOODS
         ORDER BY ORDER_NO, GOODS_NO, ITEM_NO
    </select>

    <!-- 주문번호로 조회 -->
    <select id="selectOrderGoodsByOrderNo" parameterType="string" resultType="OrderGoods">
        SELECT /* OrderGoodsMapper.selectOrderGoodsByOrderNo */
               ORDER_NO
             , GOODS_NO
             , ITEM_NO
             , SALE_PRICE
             , SUPPLY_PRICE
             , GOODS_NAME
             , ITEM_NAME
          FROM ORDER_GOODS
         WHERE ORDER_NO = #{orderNo}
         ORDER BY GOODS_NO, ITEM_NO
    </select>

    <!-- 복합키로 단건 조회 -->
    <select id="selectOrderGoodsByPk" resultType="OrderGoods">
        SELECT /* OrderGoodsMapper.selectOrderGoodsByPk */
               ORDER_NO
             , GOODS_NO
             , ITEM_NO
             , SALE_PRICE
             , SUPPLY_PRICE
             , GOODS_NAME
             , ITEM_NAME
          FROM ORDER_GOODS
         WHERE ORDER_NO = #{orderNo}
           AND GOODS_NO = #{goodsNo}
           AND ITEM_NO = #{itemNo}
    </select>

    <!-- 주문 완료 상품 목록 조회 -->
    <select id="selectOrderCompleteGoodsByOrderNo" parameterType="string" resultType="com.api.app.dto.response.order.OrderCompleteResponse$OrderCompleteGoods">
        SELECT /* OrderGoodsMapper.selectOrderCompleteGoodsByOrderNo */
               OG.GOODS_NO AS goodsNo
             , OG.ITEM_NO AS itemNo
             , OG.GOODS_NAME AS goodsName
             , OG.ITEM_NAME AS itemName
             , OG.SALE_PRICE AS salePrice
             , OD.QUANTITY AS quantity
             , (OG.SALE_PRICE * OD.QUANTITY) AS subtotal
          FROM ORDER_GOODS OG
         INNER JOIN ORDER_DETAIL OD
            ON OG.ORDER_NO = OD.ORDER_NO
           AND OG.GOODS_NO = OD.GOODS_NO
           AND OG.ITEM_NO = OD.ITEM_NO
         WHERE OG.ORDER_NO = #{orderNo}
           AND OD.ORDER_TYPE_CODE = '001'
           AND OD.ORDER_PROCESS_SEQUENCE = 1
         ORDER BY OD.ORDER_SEQUENCE
    </select>

</mapper>
