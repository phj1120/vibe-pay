<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.api.app.repository.goods.GoodsItemMapper">

    <!-- 상품의 단품 목록 조회 -->
    <select id="selectGoodsItemsByGoodsNo" parameterType="string" resultType="GoodsItemResponse">
        SELECT /* GoodsItemMapper.selectGoodsItemsByGoodsNo */
               I.GOODS_NO
             , I.ITEM_NO
             , I.ITEM_NAME
             , I.ITEM_PRICE
             , I.STOCK
             , I.GOODS_STATUS_CODE
             , C.CODE_NAME AS GOODS_STATUS_NAME
             , CASE
                   WHEN I.GOODS_STATUS_CODE != '001' OR I.STOCK = 0
                   THEN TRUE
                   ELSE FALSE
               END AS IS_SOLD_OUT
          FROM GOODS_ITEM I
          LEFT JOIN CODE_DETAIL C
            ON C.GROUP_CODE = 'PRD001'
           AND C.CODE = I.GOODS_STATUS_CODE
         WHERE I.GOODS_NO = #{goodsNo}
         ORDER BY I.ITEM_NO
    </select>

</mapper>
