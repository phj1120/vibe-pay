<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.api.app.repository.basket.BasketBaseMapper">

    <!-- 장바구니 전체 조회 -->
    <select id="selectAllBasketBase" resultType="BasketBase">
        SELECT /* BasketBaseMapper.selectAllBasketBase */
               BASKET_NO
             , MEMBER_NO
             , GOODS_NO
             , ITEM_NO
             , QUANTITY
             , IS_ORDER
          FROM BASKET_BASE
         ORDER BY BASKET_NO
    </select>

    <!-- 장바구니번호로 조회 -->
    <select id="selectBasketBaseByBasketNo" parameterType="string" resultType="BasketBase">
        SELECT /* BasketBaseMapper.selectBasketBaseByBasketNo */
               BASKET_NO
             , MEMBER_NO
             , GOODS_NO
             , ITEM_NO
             , QUANTITY
             , IS_ORDER
          FROM BASKET_BASE
         WHERE BASKET_NO = #{basketNo}
    </select>

    <!-- 회원번호로 조회 -->
    <select id="selectBasketBaseByMemberNo" parameterType="string" resultType="BasketBase">
        SELECT /* BasketBaseMapper.selectBasketBaseByMemberNo */
               BASKET_NO
             , MEMBER_NO
             , GOODS_NO
             , ITEM_NO
             , QUANTITY
             , IS_ORDER
          FROM BASKET_BASE
         WHERE MEMBER_NO = #{memberNo}
         ORDER BY BASKET_NO
    </select>

    <!-- 회원번호로 장바구니 목록 조회 (상품/단품 정보 포함) -->
    <select id="selectBasketListByMemberNo" parameterType="string" resultType="BasketResponse">
        SELECT /* BasketBaseMapper.selectBasketListByMemberNo */
               B.BASKET_NO
             , B.MEMBER_NO
             , B.GOODS_NO
             , G.GOODS_NAME
             , G.GOODS_STATUS_CODE
             , G.GOODS_MAIN_IMAGE_URL
             , B.ITEM_NO
             , I.ITEM_NAME
             , I.ITEM_PRICE
             , I.GOODS_STATUS_CODE AS ITEM_STATUS_CODE
             , I.STOCK
             , B.QUANTITY
             , B.IS_ORDER
             , B.REGIST_DATE_TIME
          FROM BASKET_BASE B
         INNER JOIN GOODS_BASE G
            ON B.GOODS_NO = G.GOODS_NO
         INNER JOIN GOODS_ITEM I
            ON B.GOODS_NO = I.GOODS_NO
           AND B.ITEM_NO = I.ITEM_NO
         WHERE B.MEMBER_NO = #{memberNo}
           AND B.IS_ORDER = FALSE
         ORDER BY B.REGIST_DATE_TIME DESC
    </select>

    <!-- 회원번호 + 상품번호 + 단품번호로 장바구니 조회 -->
    <select id="selectBasketBaseByMemberAndItem" resultType="BasketBase">
        SELECT /* BasketBaseMapper.selectBasketBaseByMemberAndItem */
               BASKET_NO
             , MEMBER_NO
             , GOODS_NO
             , ITEM_NO
             , QUANTITY
             , IS_ORDER
             , REGIST_ID
             , REGIST_DATE_TIME
             , MODIFY_ID
             , MODIFY_DATE_TIME
          FROM BASKET_BASE
         WHERE MEMBER_NO = #{memberNo}
           AND GOODS_NO = #{goodsNo}
           AND ITEM_NO = #{itemNo}
           AND IS_ORDER = FALSE
    </select>

</mapper>
